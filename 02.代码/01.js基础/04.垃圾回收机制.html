<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
    /*
        垃圾回收机制
        1.什么是垃圾回收机制
            他是浏览器中用来回收内存的一段代码

        2.垃圾回收机制的作用
            用来回收没有人使用的对象
                如果一个对象没有任何标识/属性存储他的地址值,那个说明当前对象是一个无用对象
                那么垃圾回收机制,就会找到这片内存,将其释放

            注意:
                基本数据类型,只存在覆盖的情况,不需要垃圾回收机制

        3.垃圾回收机制的核心算法
            第一种算法(旧版):引用计数法
                js会给创建的每一个对象,都会添加上一个属性[[count]],初始值为1
                    该对象每被一个标识/属性引用,那么他的count属性值就会+1
                    该对象每被一个标识/属性解除引用,那么他的count属性值就会-1

                最终,垃圾回收机制会将count为0的对象进行回收,并将其占用的内存进行释放

                被淘汰的原因(因为有重大BUG)
                    如果多个对象互相循环引用的话,那么即便是把存储他们的变量都清空,
                        但是由于他们各自之间还在引用对方,会导致这些对象的count属性都不为0

                        最终结果:我们在代码中,找不到这些对象,但是他们永生了


            第二种算法(新版):标记清除法(Scavenger)
                该算法一共存在两片区域:新生代区和老生代区
                简单总结:新版垃圾回收机制,会从window对象身上开始扫描,
                        读取他身上所有的对象,如果在扫描过程中,能见到的对象,就说明是需要保留的,
                        如果扫描结束之后,from数组中,还存在的对象,就是需要释放的

                新生代区(相当于是试用期的员工)
                    该区域专门用于存放一些刚创建的新对象
                    新生代区分为from和to两个数组

                    首次准备工作:
                        浏览器会先扫描一遍window身上所有的属性,
                        如果属性值是一个对象,那么就继续遍历该对象身上所有的属性,
                        如果内部的属性还是对象,继续遍历,以此类推

                        最终将刚才遍历过程中,遇到的所有对象都存入from数组中

                    每个一段时间都会启动一次垃圾回收机制:
                        1.重新开始扫描window身上所有的属性
                        2.如果遇到了对象,就将其从from数组中移到to数组中去
                        3.如果对象中存有对象,就继续遍历,以此类推
                        4.最终当所有的属性都遍历结束之后,from数组中,还遗留的对象就是需要回收的对象
                        5.垃圾回收机制就会将from数组中,还遗留的对象占用的内存全部释放掉
                        6.将to数组变成from数组,from数组变成to数组

                    算法目的:以空间换时间

                老生代区(相当于是正式员工)
                    该区域专门用于存放一些存活时间比较久的老对象
                    老生代区只有一个数组

                    问题:一个对象如何变成老生代区的对象?
                    回答:一个对象如果在to数组中出现三次,那么他就会成为老生代区的对象

                    流程:
                        1.重新开始扫描window身上所有的属性
                        2.如果发现扫描到的对象,已经存在于老生代区中,就会给其打上一个标记
                            当所有的属性都遍历结束之后,身上没有标记的对象,就是需要回收的对象
                        3.此时垃圾回收机制,会遍历老生代区的数组,将内部没有标记的对象,全部释放
                        4.等无用对象都被释放掉之后,会再次遍历老生代区数组,重新整理排列内部对象的排列位置
                            将多余的内存空间,全部组合到最后去

                    算法目的:以时间换空间
                    

        4.写代码时候的注意点
            1.尽量不要把东西放在全局中
                因为window对象会永久存活,只有等网页关闭才会销毁
    */
//    var a = {

//    };

    // var obj = {
    //     name:"xiaoming"
    // }

    // var obj2 = obj;

    // obj = null;
    // obj2 = null;
    
    //-----------------------------

    var obj = {
        name:"xiaoming"
    }

    var obj2 = {
        name:"xiaohong"
    };

    obj.obj2 = obj2;
    obj2.obj = obj;

    // obj.obj2 = null;
    // obj2.obj = null;

    obj = null;
    obj2 = null;

    //---------------------------------------

    // window.obj = {
    //     a:{
    //         d:{

    //         },
    //         e:{
    //             g:{

    //             }
    //         }
    //     },
    //     b:{
    //         f:{

    //         }
    //     },
    //     c:{}
    // }

    // obj.c = null;
    // obj.a.d = null;
    </script>
</body>
</html>